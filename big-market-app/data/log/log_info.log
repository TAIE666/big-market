25-06-26.14:21:20.468 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_391 on LAPTOP-RN9B7MCO with PID 21856 (started by 11140 in E:\java\Project\big-market\big-market-app)
25-06-26.14:21:20.470 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-06-26.14:21:23.534 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-06-26.14:21:23.554 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-06-26.14:21:23.671 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 84 ms. Found 0 Redis repository interfaces.
25-06-26.14:21:27.450 [main            ] INFO  Version                - Redisson 3.23.4
25-06-26.14:21:28.766 [redisson-netty-2-5] INFO  MasterPubSubConnectionPool - 1 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.14:21:28.786 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.14:21:35.854 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-06-26.14:21:36.008 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [192.168.48.128:5672]
25-06-26.14:21:36.305 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#5ebfe7fa:0/SimpleConnection@53dd29e0 [delegate=amqp://admin@192.168.48.128:5672/, localPort= 4874]
25-06-26.14:21:36.450 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 16.992 seconds (JVM running for 20.662)
25-06-26.14:21:36.962 [main            ] INFO  RaffleActivityController - 活动抽奖 userId:coudou activityId:100301
25-06-26.14:21:37.219 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.14:21:38.064 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.14:21:38.214 [main            ] INFO  RaffleActivityController - 活动抽奖，创建订单 userId:coudou activityId:100301 orderId:637860220076
25-06-26.14:21:38.253 [main            ] INFO  DefaultLogicChain      - 抽奖责任链-默认处理 userId: coudou strategyId: 100006 ruleModel: rule_default awardId: 107
25-06-26.14:21:38.255 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 coudou 100006 107 rule_default
25-06-26.14:21:38.255 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.14:21:38.292 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.14:21:38.328 [main            ] INFO  RuleLockLogicTreeNode  - 规则过滤-次数锁 userId:coudou strategyId:100006 awardId:107
25-06-26.14:21:38.341 [main            ] INFO  RuleLockLogicTreeNode  - 规则过滤-次数锁【放行】 userId:coudou strategyId:100006 awardId:107 raffleCount:2 userRaffleCount:2
25-06-26.14:21:38.342 [main            ] INFO  DecisionTreeEngine     - 决策树引擎【规则树】treeId:tree_lock_1 node:rule_lock code:0000
25-06-26.14:21:38.344 [main            ] INFO  RuleStockLogicTreeNode - 规则过滤-库存扣减 userId:coudou strategyId:100006 awardId:107
25-06-26.14:21:38.351 [main            ] INFO  RuleStockLogicTreeNode - 规则过滤-库存扣减-成功 userId:coudou strategyId:100006 awardId:107
25-06-26.14:21:38.426 [main            ] INFO  DecisionTreeEngine     - 决策树引擎【规则树】treeId:tree_lock_1 node:rule_stock code:0001
25-06-26.14:21:38.426 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-规则树 coudou 100006 107 
25-06-26.14:21:38.871 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardId":107,"awardTitle":"2等奖","userId":"coudou"},"id":"04332023191","timestamp":1750918898442}
25-06-26.14:21:38.885 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"coudou"}
25-06-26.14:21:38.886 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardId":107,"awardTitle":"2等奖","userId":"coudou"},"id":"04332023191","timestamp":1750918898442}
25-06-26.14:21:38.892 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":107,"awardIndex":7,"awardTitle":"2等奖"},"info":"调用成功"}
25-06-26.14:21:38.918 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.14:21:38.921 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.14:21:39.432 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.14:21:39.900 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.14:21:39.905 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.14:21:39.906 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.14:21:53.082 [main            ] INFO  RaffleStrategyControllerTest - Starting RaffleStrategyControllerTest using Java 1.8.0_391 on LAPTOP-RN9B7MCO with PID 20848 (started by 11140 in E:\java\Project\big-market\big-market-app)
25-06-26.14:21:53.085 [main            ] INFO  RaffleStrategyControllerTest - The following 1 profile is active: "dev"
25-06-26.14:21:54.838 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-06-26.14:21:54.844 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-06-26.14:21:54.939 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 71 ms. Found 0 Redis repository interfaces.
25-06-26.14:21:57.931 [main            ] INFO  Version                - Redisson 3.23.4
25-06-26.14:21:59.456 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.14:21:59.476 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.14:22:05.923 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-06-26.14:22:06.083 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [192.168.48.128:5672]
25-06-26.14:22:06.212 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#56a9b662:0/SimpleConnection@8cce9ad [delegate=amqp://admin@192.168.48.128:5672/, localPort= 4989]
25-06-26.14:22:06.402 [main            ] INFO  RaffleStrategyControllerTest - Started RaffleStrategyControllerTest in 14.022 seconds (JVM running for 16.274)
25-06-26.14:22:06.835 [main            ] INFO  RaffleStrategyController - 查询抽奖奖品列表配开始 userId:coudou activityId：100301
25-06-26.14:22:06.892 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.14:22:07.653 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.14:22:36.700 [scheduling-1    ] INFO  UpdateAwardStockJob    - 定时任务，更新奖品消耗库存【延迟队列获取，降低对数据库的更新频次，不要产生竞争】
25-06-26.14:23:15.964 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=1m8s203ms312µs700ns).
25-06-26.14:25:02.785 [Retail_HikariCP housekeeper] WARN  HikariPool             - Retail_HikariCP - Thread starvation or clock leap detected (housekeeper delta=1m46s820ms758µs200ns).
25-06-26.14:25:02.830 [scheduling-1    ] INFO  UpdateActivitySkuStockJob - 定时任务，更新活动sku库存【延迟队列获取，降低对数据库的更新频次，不要产生竞争】
25-06-26.14:25:02.870 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.14:25:02.879 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.14:25:02.947 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.14:25:02.958 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.14:25:03.567 [main            ] INFO  RaffleStrategyController - 查询抽奖奖品列表配置完成 userId:coudou activityId：100301 response: {"code":"0000","data":[{"awardId":101,"awardTitle":"随机积分","isAwardUnlock":true,"sort":1,"waitUnLockCount":0},{"awardId":102,"awardTitle":"7等奖","isAwardUnlock":true,"sort":2,"waitUnLockCount":0},{"awardId":103,"awardTitle":"6等奖","isAwardUnlock":true,"sort":3,"waitUnLockCount":0},{"awardId":104,"awardTitle":"5等奖","isAwardUnlock":true,"sort":4,"waitUnLockCount":0},{"awardId":105,"awardTitle":"4等奖","isAwardUnlock":true,"sort":5,"waitUnLockCount":0},{"awardId":106,"awardSubtitle":"抽奖1次后解锁","awardTitle":"3等奖","isAwardUnlock":true,"sort":6,"waitUnLockCount":0},{"awardId":107,"awardSubtitle":"抽奖1次后解锁","awardTitle":"2等奖","isAwardUnlock":true,"sort":7,"waitUnLockCount":0},{"awardId":108,"awardSubtitle":"抽奖2次后解锁","awardTitle":"1等奖","isAwardUnlock":true,"sort":8,"waitUnLockCount":0}],"info":"调用成功"}
25-06-26.14:25:03.571 [main            ] INFO  RaffleStrategyControllerTest - 请求参数：{"activityId":100301,"userId":"coudou"}
25-06-26.14:25:03.572 [main            ] INFO  RaffleStrategyControllerTest - 测试结果：{"code":"0000","data":[{"awardId":101,"awardTitle":"随机积分","isAwardUnlock":true,"sort":1,"waitUnLockCount":0},{"awardId":102,"awardTitle":"7等奖","isAwardUnlock":true,"sort":2,"waitUnLockCount":0},{"awardId":103,"awardTitle":"6等奖","isAwardUnlock":true,"sort":3,"waitUnLockCount":0},{"awardId":104,"awardTitle":"5等奖","isAwardUnlock":true,"sort":4,"waitUnLockCount":0},{"awardId":105,"awardTitle":"4等奖","isAwardUnlock":true,"sort":5,"waitUnLockCount":0},{"awardId":106,"awardSubtitle":"抽奖1次后解锁","awardTitle":"3等奖","isAwardUnlock":true,"sort":6,"waitUnLockCount":0},{"awardId":107,"awardSubtitle":"抽奖1次后解锁","awardTitle":"2等奖","isAwardUnlock":true,"sort":7,"waitUnLockCount":0},{"awardId":108,"awardSubtitle":"抽奖2次后解锁","awardTitle":"1等奖","isAwardUnlock":true,"sort":8,"waitUnLockCount":0}],"info":"调用成功"}
25-06-26.14:25:03.605 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.14:25:03.609 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.14:25:03.800 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.14:25:03.800 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.14:25:03.810 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.14:25:03.812 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.19:47:33.256 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_391 on LAPTOP-RN9B7MCO with PID 24064 (started by 11140 in E:\java\Project\big-market\big-market-app)
25-06-26.19:47:33.257 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-06-26.19:47:35.034 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-06-26.19:47:35.040 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-06-26.19:47:35.136 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 73 ms. Found 0 Redis repository interfaces.
25-06-26.19:47:37.989 [main            ] INFO  Version                - Redisson 3.23.4
25-06-26.19:47:38.965 [redisson-netty-2-5] INFO  MasterPubSubConnectionPool - 1 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.19:47:38.999 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.19:47:45.005 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-06-26.19:47:45.159 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [192.168.48.128:5672]
25-06-26.19:47:45.301 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#30d5e37c:0/SimpleConnection@2066e897 [delegate=amqp://admin@192.168.48.128:5672/, localPort= 2249]
25-06-26.19:47:45.410 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 12.959 seconds (JVM running for 15.383)
25-06-26.19:47:46.065 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"20240429","userId":"coudou"}
25-06-26.19:47:46.071 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：[]
25-06-26.19:47:46.093 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.19:47:46.095 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.19:47:46.388 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.19:47:46.388 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.19:47:46.391 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.19:47:46.392 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.19:50:12.034 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_391 on LAPTOP-RN9B7MCO with PID 30568 (started by 11140 in E:\java\Project\big-market\big-market-app)
25-06-26.19:50:12.035 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-06-26.19:50:13.392 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-06-26.19:50:13.395 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-06-26.19:50:13.472 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 59 ms. Found 0 Redis repository interfaces.
25-06-26.19:50:16.093 [main            ] INFO  Version                - Redisson 3.23.4
25-06-26.19:50:17.057 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.19:50:17.080 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.19:50:21.858 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-06-26.19:50:21.984 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [192.168.48.128:5672]
25-06-26.19:50:22.079 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#30d5e37c:0/SimpleConnection@1123d461 [delegate=amqp://admin@192.168.48.128:5672/, localPort= 2393]
25-06-26.19:50:22.167 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 10.624 seconds (JVM running for 12.39)
25-06-26.19:50:22.506 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.19:50:22.853 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.19:50:22.906 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.19:50:22.934 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.19:50:23.325 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"coudou_sku_20240429","rebateConfig":"9011","rebateType":"sign","userId":"coudou"},"id":"47595388772","timestamp":1750938622900}
25-06-26.19:50:23.348 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"coudou_integral_20240429","rebateConfig":"10","rebateType":"sign","userId":"coudou"},"id":"12173075281","timestamp":1750938622903}
25-06-26.19:50:23.359 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"20240429","userId":"coudou"}
25-06-26.19:50:23.365 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["580389926167","716741230943"]
25-06-26.19:50:23.382 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.19:50:23.384 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.19:50:24.156 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.19:50:24.156 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.19:50:24.159 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.19:50:24.159 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.19:51:04.403 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_391 on LAPTOP-RN9B7MCO with PID 29948 (started by 11140 in E:\java\Project\big-market\big-market-app)
25-06-26.19:51:04.405 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-06-26.19:51:05.990 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-06-26.19:51:05.995 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-06-26.19:51:06.098 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 0 Redis repository interfaces.
25-06-26.19:51:08.400 [main            ] INFO  Version                - Redisson 3.23.4
25-06-26.19:51:09.390 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.19:51:09.409 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 192.168.48.128/192.168.48.128:16379
25-06-26.19:51:14.412 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-06-26.19:51:14.551 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [192.168.48.128:5672]
25-06-26.19:51:14.651 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#30d5e37c:0/SimpleConnection@1123d461 [delegate=amqp://admin@192.168.48.128:5672/, localPort= 2537]
25-06-26.19:51:14.755 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 11.19 seconds (JVM running for 13.295)
25-06-26.19:51:15.010 [scheduling-1    ] INFO  UpdateActivitySkuStockJob - 定时任务，更新活动sku库存【延迟队列获取，降低对数据库的更新频次，不要产生竞争】
25-06-26.19:51:15.052 [scheduling-1    ] INFO  UpdateAwardStockJob    - 定时任务，更新奖品消耗库存【延迟队列获取，降低对数据库的更新频次，不要产生竞争】
25-06-26.19:51:15.105 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.19:51:15.105 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.19:51:15.159 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-06-26.19:51:15.526 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.19:51:15.526 [pool-3-thread-1 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.19:51:15.527 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-06-26.19:51:15.657 [main            ] ERROR BehaviorRebateRepository - 写入返利记录，唯一索引冲突 userId: coudou
org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'coudou_sku_20240429' for key 'user_behavior_rebate_order_003.uq_biz_id'
### The error may exist in file [E:\java\Project\big-market\big-market-app\target\classes\mybatis\mapper\user_behavior_rebate_order_mapper.xml]
### The error may involve cn.coudou.infrastructure.persistent.dao.IUserBehaviorRebateOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_behavior_rebate_order_003(             user_id, order_id, behavior_type, rebate_desc, rebate_type, rebate_config, biz_id, create_time, update_time         ) values(                     ?, ?, ?, ?, ?, ?, ?, now(), now()                 )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'coudou_sku_20240429' for key 'user_behavior_rebate_order_003.uq_biz_id'
; Duplicate entry 'coudou_sku_20240429' for key 'user_behavior_rebate_order_003.uq_biz_id'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'coudou_sku_20240429' for key 'user_behavior_rebate_order_003.uq_biz_id'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy109.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy145.insert(Unknown Source)
	at cn.coudou.infrastructure.persistent.repository.BehaviorRebateRepository.lambda$saveUserRebateRecord$0(BehaviorRebateRepository.java:82)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at cn.coudou.infrastructure.persistent.repository.BehaviorRebateRepository.saveUserRebateRecord(BehaviorRebateRepository.java:69)
	at cn.coudou.infrastructure.persistent.repository.BehaviorRebateRepository$$FastClassBySpringCGLIB$$dd0c056d.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at cn.coudou.infrastructure.persistent.repository.BehaviorRebateRepository$$EnhancerBySpringCGLIB$$374027c4.saveUserRebateRecord(<generated>)
	at cn.coudou.domain.rebate.service.BehaviorRebateService.createOrder(BehaviorRebateService.java:84)
	at cn.coudou.test.domain.rebate.BehaviorRebateServiceTest.test_createOrder(BehaviorRebateServiceTest.java:32)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'coudou_sku_20240429' for key 'user_behavior_rebate_order_003.uq_biz_id'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy203.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 54 common frames omitted
25-06-26.19:51:15.725 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.19:51:15.725 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-06-26.19:51:15.755 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.19:51:15.766 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-06-26.19:51:15.772 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-06-26.19:51:15.773 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
